!function(){"use strict";const e="#0000FF",t=["swim","aqua","pool","water","lap","public swim","family swim","lane swim","recreational swim","members swim"],n=["skating club","hockey","ice"],s="Members Only",r="Busy/Maintenance",o="Sensory Swim",i="Women's Only (All Pools)",a="Seniors 60+ Only",c="Regular",l="status-indicator",d="open",m="closed",u="members",S="restricted",y="members-checkmark",g="restricted-checkmark",w="checkmark",f="cross",h="current",b="past",E="busy",p="event",D="error",A="active",v="tab",L="tab-content",O="lanes-status",C="kids-status",I="lanes-time",T="kids-time",$="schedule-content",k="last-updated",_="user-timezone",N="date-select",B="today-btn",P="tomorrow-btn",M="current-event",x="#schedule h3",Y="lane",R="play open",W="play pool",U="play pools",F=["play & therapy","play and therapy"],V="family",q="sensory",H="recreational",G=["aquafit using lap pool","elderfit using lap pool"],K={SPECIAL_EVENTS:{BUSY:"Busy",POOL_PARTY:"Pool Party",PRIVATE_POOL_PARTY:"Private Pool Party Rental"},LANES_ALWAYS_OPEN:["members swim","senior swim","women's only swim","modl women's only swim","lane swim","recreational swim"],LANES_ALWAYS_CLOSED:["lap pool closed","no lanes","public swim - no lanes","public swimming - no lanes","busy","aquafit using lap pool","elderfit using lap pool"],KIDS_ALWAYS_OPEN:["members swim","women's only swim","modl women's only swim","public swim - no lanes","public swim","public swimming","recreational swim","family swim"],KIDS_ALWAYS_CLOSED:["senior swim","lane swim only","busy","parent & tot swim"],ACCESS_MEMBERS:["members swim","member only"],ACCESS_WOMENS:["women's only swim","modl women's only swim","women only"],ACCESS_SENIORS:["senior swim","seniors 60+"]},j="lclc_schedule_cache",J="lclc_schedule_timestamp";function z(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}T${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:00-03:00`}function Z(){try{if(!function(){try{const e=localStorage.getItem(J);if(!e)return!1;const t=parseInt(e,10);return Date.now()-t<18e5}catch(e){return console.warn("Error checking cache validity:",e),!1}}())return null;const e=localStorage.getItem(j);return e?JSON.parse(e):null}catch(e){return console.warn("Error retrieving cache:",e),null}}async function Q(e=2){const t=new Date;t.setHours(0,0,0,0);const n=new Date;n.setDate(n.getDate()+8),n.setHours(0,0,0,0);const s=`https://www.connect2rec.com/Facility/GetScheduleCustomAppointments?selectedId=3121e68a-d46d-4865-b4ce-fc085f688529&start=${z(t)}&end=${z(n)}`;try{const e=await fetch("https://corsproxy.io/?"+encodeURIComponent(s),{headers:{Accept:"application/json"},signal:AbortSignal.timeout(8e3)});if(!e.ok)throw new Error(`Failed to fetch schedule: ${e.status}`);const t=await e.json();return function(e){try{localStorage.setItem(j,JSON.stringify(e)),localStorage.setItem(J,Date.now().toString())}catch(e){console.warn("Error caching schedule:",e)}}(t),t}catch(t){if(console.error("Error fetching schedule:",t),e>0)return console.log(`Retrying... (${e} attempts left)`),await Q(e-1);throw t}}function X(e){const t=new Date(e);if(isNaN(t.getTime()))return console.error("Invalid date:",e),null;const n=(new Date).getTimezoneOffset()+(t.getMonth()>=3&&t.getMonth()<=10?-180:-240);return new Date(t.getTime()+60*n*1e3)}function ee(e){return e?e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):""}function te(s){const r=s.title||"",o=r.toLowerCase();if(r===K.SPECIAL_EVENTS.BUSY)return!0;if(s.backgroundColor===e)return!n.some((e=>o.includes(e)))&&(r!==K.SPECIAL_EVENTS.POOL_PARTY&&r!==K.SPECIAL_EVENTS.PRIVATE_POOL_PARTY);return t.some((e=>o.includes(e)))}function ne(e,t){const n=e.toLowerCase();return Array.isArray(t)?t.some((e=>n.includes(e))):n.includes(t)}function se(e){const t=e.match(/(\d+)\s+lane/i);return{hasLanes:null!==t,count:t?parseInt(t[1]):0}}function re(e){const t=e.title,n=t.toLowerCase();if(t===K.SPECIAL_EVENTS.BUSY)return{lanes:!1,kids:!1,membersOnly:!1,restrictedAccess:!1,type:r,details:{lanes:0}};let l=!1;if(ne(t,K.LANES_ALWAYS_CLOSED)||ne(t,G))l=!1;else if(ne(t,K.LANES_ALWAYS_OPEN))l=!0;else{l=se(t).hasLanes||ne(t,Y)}let d=!1;d=!ne(t,K.KIDS_ALWAYS_CLOSED)&&(!!ne(t,K.KIDS_ALWAYS_OPEN)||(!!function(e){const t=e.toLowerCase();return ne(e,R)||ne(e,W)||ne(e,U)||ne(e,F)||t.includes("play")&&t.includes("open")}(t)||(!(!ne(t,H)||n.includes("no play"))||ne(t,V))));const m=ne(t,K.ACCESS_MEMBERS),u=ne(t,[...K.ACCESS_WOMENS,...K.ACCESS_SENIORS]);let S=c;ne(t,K.ACCESS_WOMENS)?S=i:ne(t,K.ACCESS_SENIORS)?S=a:ne(t,q)?S=o:m&&(S=s);return{lanes:l,kids:d,membersOnly:m,restrictedAccess:u,type:S,details:{lanes:se(t).count}}}const oe=new class{constructor(){this.allEvents=[],this.currentTab="current",this.lastUpdated=null,this.subscribers=[],this.isLoading=!1,this.error=null,this.selectedDate=new Date}setEvents(e){this.allEvents=e.map((e=>({...e,start:new Date(e.start),end:new Date(e.end)}))),this.lastUpdated=new Date,this.isLoading=!1,this.error=null,this.notifySubscribers()}setSelectedDate(e){e instanceof Date&&!isNaN(e.getTime())&&(this.selectedDate=e,this.notifySubscribers())}getEventsForDate(e){if(!e)return[];const t=e.toDateString();return this.allEvents.filter((e=>new Date(e.start).toDateString()===t))}setLoading(e){this.isLoading=e,this.notifySubscribers()}setError(e){this.error=e,this.isLoading=!1,this.notifySubscribers()}setTab(e){"current"!==e&&"schedule"!==e||(this.currentTab=e,this.notifySubscribers())}subscribe(e){"function"==typeof e&&this.subscribers.push(e)}unsubscribe(e){this.subscribers=this.subscribers.filter((t=>t!==e))}notifySubscribers(){this.subscribers.forEach((e=>{try{e()}catch(e){console.error("Error in subscriber callback:",e)}}))}};function ie(e,t,n){const s=t.toDateString(),r=e.filter((e=>new Date(e.start).toDateString()===s));r.sort(((e,t)=>new Date(e.start)-new Date(t.start)));let o=null,i=null,a=null,c=!1,l=!1,d=null;for(const e of r){const s=new Date(e.start),r=new Date(e.end);if(s<=t&&r>t){const t=re(e);if("lanes"===n&&t.lanes||"kids"===n&&t.kids){if(o=e,c=t.restrictedAccess,l=t.membersOnly,d=t.type,c||l)return{isActive:!0,endTime:r,details:t.details||{},restrictedAccess:c,membersOnly:l,restrictionType:d,specialEvent:!0,eventTitle:e.title};break}}}if(o){i=new Date(o.end);let e=i;const s=[...r].sort(((e,t)=>new Date(e.start)-new Date(t.start)));for(const r of s){const s=new Date(r.start),a=new Date(r.end);if(s<=t||new Date(r.start)<=new Date(o.start))continue;const c=re(r),l="lanes"===n&&c.lanes||"kids"===n&&c.kids;if(Math.abs(s-e)<6e4&&l){if(c.restrictedAccess||c.membersOnly)break;i=a,e=a}else if(s>e)break}return{isActive:!0,endTime:i,details:re(o).details||{},restrictedAccess:c,membersOnly:l,restrictionType:d,specialEvent:!1,eventTitle:o.title}}if(!o){for(const e of r){const s=new Date(e.start);if(s>t){const t=re(e);if("lanes"===n&&t.lanes||"kids"===n&&t.kids){a=s,c=t.restrictedAccess,l=t.membersOnly;break}}}if(a)return{isActive:!1,inGap:!0,nextStartTime:a,restrictedAccess:c,membersOnly:l}}return{isActive:!1,inGap:!1}}function ae(e){if(!e.isActive){if(e.inGap){let t=`Opens at ${ee(e.nextStartTime)}`;return e.restrictedAccess?t+=" (Restricted)":e.membersOnly&&(t+=" (Members Only)"),t}return"No more swimming today"}let t=function(e){if(!e)return"Unknown";const t=e-new Date;if(t<=0)return"Ended";const n=Math.floor(t/36e5),s=Math.floor(t%36e5/6e4);return n>0?`${n}h ${s}m remaining`:`${s}m remaining`}(e.endTime);if(e.restrictedAccess){return`${e.restrictionType===i?"Women only":e.restrictionType===a?"Seniors 60+":"Restricted access"} - ${t}`}return e.membersOnly?`Members only - ${t}`:t}function ce(){const e=new Date,t=ie(oe.allEvents,e,"lanes"),n=ie(oe.allEvents,e,"kids"),s=document.getElementById(O),r=document.getElementById(C),o=document.getElementById(I),i=document.getElementById(T);if(!(s&&r&&o&&i))return void console.warn("Status elements not found");s.textContent=t.isActive?"YES":"NO",r.textContent=n.isActive?"YES":"NO",s.className=`${l} ${t.restrictedAccess?S:t.membersOnly?u:t.isActive?d:m}`,r.className=`${l} ${n.restrictedAccess?S:n.membersOnly?u:n.isActive?d:m}`,o.textContent=ae(t),i.textContent=ae(n);const a=document.getElementById(k);a&&oe.lastUpdated&&(a.textContent=oe.lastUpdated.toLocaleTimeString())}function le(){!function(){const e=document.getElementById(N);if(!e)return void console.warn("Date selector not found");const t=new Date,n=[];for(let e=0;e<8;e++){const s=new Date(t);s.setDate(t.getDate()+e),n.push(s)}e.innerHTML=n.map((e=>{const n=e.toDateString(),s=n===t.toDateString(),r=n===new Date(t.getTime()+864e5).toDateString();let o;return o=s?"Today":r?"Tomorrow":e.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),`<option value="${n}" ${s?"selected":""}>${o}</option>`})).join(""),e.addEventListener("change",(e=>{const t=new Date(e.target.value);oe.setSelectedDate(t)}));const s=document.getElementById(B);s&&s.addEventListener("click",(()=>{e.value=t.toDateString(),oe.setSelectedDate(t)}));const r=document.getElementById(P);r&&r.addEventListener("click",(()=>{const n=new Date(t.getTime()+864e5);e.value=n.toDateString(),oe.setSelectedDate(n)}))}(),oe.subscribe((()=>{!function(){const e=oe.selectedDate||new Date,t=e.toDateString(),n=document.getElementById($);if(!n)return void console.warn("Schedule content element not found");const s=new Date,r=oe.getEventsForDate(e);if(0===r.length)n.innerHTML='<div class="event">No swimming events scheduled for this day.</div>';else{const o=document.querySelector(x);o&&(t===s.toDateString()?o.textContent="Today's Swimming Schedule":t===new Date(s.getTime()+864e5).toDateString()?o.textContent="Tomorrow's Swimming Schedule":o.textContent=`Swimming Schedule for ${e.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}`),n.innerHTML=r.map((e=>{const n=re(e),r=e.start<=s&&e.end>=s&&t===s.toDateString(),o=e.end<s;let i="";r?i="Busy/Maintenance"===n.type?E:n.restrictedAccess?S:n.membersOnly?u:h:o?i=b:n.membersOnly?i=u:n.restrictedAccess?i=S:"Busy/Maintenance"===n.type&&(i=E);const a=n.lanes&&!e.title.includes("LAP POOL CLOSED"),c=n.restrictedAccess?g:n.membersOnly?y:a?w:f,l=n.restrictedAccess?g:n.membersOnly?y:n.kids?w:f;let d="";return n.membersOnly?d="(Members Only)":n.restrictedAccess&&(d="Women's Only (All Pools)"===n.type?"(Women Only)":"(Seniors 60+ Only)"),`\n          <div class="${p} ${i}" ${r?`id="${M}"`:""}>\n              <div class="event-time">\n                  ${ee(e.start)} -\n                  ${ee(e.end)}\n                  ${r?'<span style="margin-left: 10px; color: #28a745;">◉ NOW</span>':""}\n              </div>\n              <div class="event-title">${e.title}</div>\n              <div class="event-details">\n                  Lanes: <span class="${c}">${a?"✓":"✗"}</span> |\n                  Kids: <span class="${l}">${n.kids?"✓":"✗"}</span>\n                  ${d?`<br><span style="margin-left: 10px; color: ${n.restrictedAccess?"#9c27b0":"#0056b3"}; font-weight: bold;">${d}</span>`:""}\n              </div>\n          </div>\n        `})).join(""),t===s.toDateString()&&setTimeout((()=>{const e=document.getElementById(M);e&&e.scrollIntoView({behavior:"smooth",block:"center"})}),100)}}(),function(){const e=oe.selectedDate,t=new Date,n=new Date(t.getTime()+864e5),s=document.getElementById(B),r=document.getElementById(P);s&&s.classList.toggle(A,e.toDateString()===t.toDateString()),r&&r.classList.toggle(A,e.toDateString()===n.toDateString())}()}))}async function de(){try{!function(e){const t=new Date,n=e.filter(te).map((e=>{const t=X(e.start),n=X(e.end);return t&&n?{id:e.id,title:e.title,start:t,end:n,backgroundColor:e.backgroundColor,textColor:e.textColor,allDay:e.allDay,facility:e.facility||"LCLC > BMO Financial Group Aquatic Centre"}:(console.warn("Skipping event with invalid dates:",e),null)})).filter((e=>null!==e)).sort(((e,t)=>e.start-t.start));oe.setEvents(n),oe.setSelectedDate(t);const s=Intl.DateTimeFormat().resolvedOptions().timeZone,r=document.getElementById(_);r&&(r.textContent=s),document.body.classList.remove("loading")}(await async function(){try{const e=Z();return e?(console.log("Using cached schedule data"),e):await Q()}catch(e){console.error("Error in fetchScheduleData:",e);try{const e=localStorage.getItem(j);if(e)return console.log("Using expired cache as fallback"),JSON.parse(e)}catch(e){console.error("Failed to use expired cache:",e)}throw e}}())}catch(e){console.error("Error:",e);const t=document.getElementById($);t&&(t.innerHTML=`<div class="${D}">Unable to load schedule. Please try again later.</div>`),document.body.classList.remove("loading")}}function me(){const e=document.getElementById(O),t=document.getElementById(C);e&&(e.textContent="-"),t&&(t.textContent="-"),document.querySelectorAll(`.${v}`).forEach((e=>{e.addEventListener("click",(()=>{if(document.querySelectorAll(`.${v}`).forEach((e=>e.classList.remove(A))),document.querySelectorAll(`.${L}`).forEach((e=>e.classList.remove(A))),e.classList.add(A),document.getElementById(`${e.dataset.tab}-tab`).classList.add(A),"schedule"===e.dataset.tab){const e=document.getElementById(N);if(e){const t=new Date(e.value),n=new Date;t.toDateString()===n.toDateString()&&setTimeout((()=>{const e=document.getElementById(M);e&&e.scrollIntoView({behavior:"smooth",block:"center"})}),100)}}}))})),document.body.classList.add("loading")}function ue(){oe.subscribe(ce),le(),de(),setInterval(de,3e5),setInterval((()=>{oe.allEvents.length>0&&ce()}),6e4)}document.addEventListener("DOMContentLoaded",(()=>{me(),setTimeout(ue,10)}))}();