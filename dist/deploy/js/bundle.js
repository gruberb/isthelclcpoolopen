!function(){"use strict";const e="#0000FF",t=["swim","aqua","pool","water","lap","public swim","family swim","lane swim","recreational swim","members swim"],n=["skating club","hockey","ice"],s="Members Only",r="Busy/Maintenance",o="Sensory Swim",i="Women's Only (All Pools)",a="Seniors 60+ Only",c="Regular",l="status-indicator",d="open",m="closed",u="members",y="restricted",S="members-checkmark",g="restricted-checkmark",f="checkmark",w="cross",b="current",h="past",E="busy",p="event",D="error",A="active",v="tab",L="tab-content",O="lanes-status",C="kids-status",T="lanes-time",I="kids-time",k="schedule-content",_="last-updated",$="user-timezone",N="date-select",B="today-btn",P="tomorrow-btn",M="current-event",x="#schedule h3",W="lane",Y="play open",R="play pool",U="play pools",F=["play & therapy","play and therapy"],V="family",q="sensory",K="recreational",j=["aquafit using lap pool","elderfit using lap pool"],G={SPECIAL_EVENTS:{BUSY:"Busy",POOL_PARTY:"Pool Party",PRIVATE_POOL_PARTY:"Private Pool Party Rental"},LANES_ALWAYS_OPEN:["members swim","senior swim","women's only swim","modl women's only swim","lane swim","recreational swim"],LANES_ALWAYS_CLOSED:["lap pool closed","no lanes","public swim - no lanes","public swimming - no lanes","busy","aquafit using lap pool","elderfit using lap pool"],KIDS_ALWAYS_OPEN:["members swim","women's only swim","modl women's only swim","public swim - no lanes","public swim","public swimming","recreational swim","family swim"],KIDS_ALWAYS_CLOSED:["senior swim","lane swim only","busy","parent & tot swim"],ACCESS_MEMBERS:["members swim","member only"],ACCESS_WOMENS:["women's only swim","modl women's only swim","women only"],ACCESS_SENIORS:["senior swim","seniors 60+"]},H="lclc_schedule_cache",J="lclc_schedule_timestamp";function z(){try{if(!function(){try{const e=localStorage.getItem(J);if(!e)return!1;const t=parseInt(e,10);return Date.now()-t<18e5}catch(e){return console.warn("Error checking cache validity:",e),!1}}())return null;const e=localStorage.getItem(H);return e?JSON.parse(e):null}catch(e){return console.warn("Error retrieving cache:",e),null}}async function Z(){try{const e=z();if(e)return console.log("Using cached schedule data"),e;const t="/data/pool.json";console.log(`Fetching pool data from ${t}`);const n=await fetch(t);if(!n.ok)throw new Error(`Failed to fetch schedule data from JSON: ${n.status}`);const s=(await n.json()).data||[];return function(e){try{localStorage.setItem(H,JSON.stringify(e)),localStorage.setItem(J,Date.now().toString())}catch(e){console.warn("Error caching schedule:",e)}}(s),s}catch(e){console.error("Error in fetchScheduleData:",e);try{const e=localStorage.getItem(H);if(e)return console.log("Using expired cache as fallback"),JSON.parse(e)}catch(e){console.error("Failed to use expired cache:",e)}throw e}}function Q(e){const t=new Date(e);if(isNaN(t.getTime()))return console.error("Invalid date:",e),null;const n=(new Date).getTimezoneOffset()+(t.getMonth()>=3&&t.getMonth()<=10?-180:-240);return new Date(t.getTime()+60*n*1e3)}function X(e){return e?e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):""}function ee(s){const r=s.title||"",o=r.toLowerCase();if(r===G.SPECIAL_EVENTS.BUSY)return!0;if(s.backgroundColor===e)return!n.some((e=>o.includes(e)))&&(r!==G.SPECIAL_EVENTS.POOL_PARTY&&r!==G.SPECIAL_EVENTS.PRIVATE_POOL_PARTY);return t.some((e=>o.includes(e)))}function te(e,t){const n=e.toLowerCase();return Array.isArray(t)?t.some((e=>n.includes(e))):n.includes(t)}function ne(e){const t=e.match(/(\d+)\s+lane/i);return{hasLanes:null!==t,count:t?parseInt(t[1]):0}}function se(e){const t=e.title,n=t.toLowerCase();if(t===G.SPECIAL_EVENTS.BUSY)return{lanes:!1,kids:!1,membersOnly:!1,restrictedAccess:!1,type:r,details:{lanes:0}};let l=!1;if(te(t,G.LANES_ALWAYS_CLOSED)||te(t,j))l=!1;else if(te(t,G.LANES_ALWAYS_OPEN))l=!0;else{l=ne(t).hasLanes||te(t,W)}let d=!1;d=!te(t,G.KIDS_ALWAYS_CLOSED)&&(!!te(t,G.KIDS_ALWAYS_OPEN)||(!!function(e){const t=e.toLowerCase();return te(e,Y)||te(e,R)||te(e,U)||te(e,F)||t.includes("play")&&t.includes("open")}(t)||(!(!te(t,K)||n.includes("no play"))||te(t,V))));const m=te(t,G.ACCESS_MEMBERS),u=te(t,[...G.ACCESS_WOMENS,...G.ACCESS_SENIORS]);let y=c;te(t,G.ACCESS_WOMENS)?y=i:te(t,G.ACCESS_SENIORS)?y=a:te(t,q)?y=o:m&&(y=s);return{lanes:l,kids:d,membersOnly:m,restrictedAccess:u,type:y,details:{lanes:ne(t).count}}}const re=new class{constructor(){this.allEvents=[],this.currentTab="current",this.lastUpdated=null,this.subscribers=[],this.isLoading=!1,this.error=null,this.selectedDate=new Date}setEvents(e){this.allEvents=e.map((e=>({...e,start:new Date(e.start),end:new Date(e.end)}))),this.lastUpdated=new Date,this.isLoading=!1,this.error=null,this.notifySubscribers()}setSelectedDate(e){e instanceof Date&&!isNaN(e.getTime())&&(this.selectedDate=e,this.notifySubscribers())}getEventsForDate(e){if(!e)return[];const t=e.toDateString();return this.allEvents.filter((e=>new Date(e.start).toDateString()===t))}setLoading(e){this.isLoading=e,this.notifySubscribers()}setError(e){this.error=e,this.isLoading=!1,this.notifySubscribers()}setTab(e){"current"!==e&&"schedule"!==e||(this.currentTab=e,this.notifySubscribers())}subscribe(e){"function"==typeof e&&this.subscribers.push(e)}unsubscribe(e){this.subscribers=this.subscribers.filter((t=>t!==e))}notifySubscribers(){this.subscribers.forEach((e=>{try{e()}catch(e){console.error("Error in subscriber callback:",e)}}))}};function oe(e,t,n){const s=t.toDateString(),r=e.filter((e=>new Date(e.start).toDateString()===s));r.sort(((e,t)=>new Date(e.start)-new Date(t.start)));let o=null,i=null,a=null,c=!1,l=!1,d=null;for(const e of r){const s=new Date(e.start),r=new Date(e.end);if(s<=t&&r>t){const t=se(e);if("lanes"===n&&t.lanes||"kids"===n&&t.kids){if(o=e,c=t.restrictedAccess,l=t.membersOnly,d=t.type,c||l)return{isActive:!0,endTime:r,details:t.details||{},restrictedAccess:c,membersOnly:l,restrictionType:d,specialEvent:!0,eventTitle:e.title};break}}}if(o){i=new Date(o.end);let e=i;const s=[...r].sort(((e,t)=>new Date(e.start)-new Date(t.start)));for(const r of s){const s=new Date(r.start),a=new Date(r.end);if(s<=t||new Date(r.start)<=new Date(o.start))continue;const c=se(r),l="lanes"===n&&c.lanes||"kids"===n&&c.kids;if(Math.abs(s-e)<6e4&&l){if(c.restrictedAccess||c.membersOnly)break;i=a,e=a}else if(s>e)break}return{isActive:!0,endTime:i,details:se(o).details||{},restrictedAccess:c,membersOnly:l,restrictionType:d,specialEvent:!1,eventTitle:o.title}}if(!o){for(const e of r){const s=new Date(e.start);if(s>t){const t=se(e);if("lanes"===n&&t.lanes||"kids"===n&&t.kids){a=s,c=t.restrictedAccess,l=t.membersOnly,d=t.type;break}}}if(a)return{isActive:!1,inGap:!0,nextStartTime:a,restrictedAccess:c,membersOnly:l,restrictionType:d}}return{isActive:!1,inGap:!1}}function ie(e){if(!e.isActive){if(e.inGap){let t=`Opens at ${X(e.nextStartTime)}`;return e.restrictedAccess?e.restrictionType===i?t+=" (Women Only)":e.restrictionType===a?t+=" (Seniors 60+)":t+=" (Restricted)":e.membersOnly&&(t+=" (Members Only)"),t}return"No more swimming today"}let t=function(e){if(!e)return"Unknown";const t=e-new Date;if(t<=0)return"Ended";const n=Math.floor(t/36e5),s=Math.floor(t%36e5/6e4);return n>0?`${n}h ${s}m remaining`:`${s}m remaining`}(e.endTime);if(e.restrictedAccess){return`${e.restrictionType===i?"Women only":e.restrictionType===a?"Seniors 60+":"Restricted access"} - ${t}`}return e.membersOnly?`Members only - ${t}`:t}function ae(){const e=new Date,t=oe(re.allEvents,e,"lanes"),n=oe(re.allEvents,e,"kids"),s=document.getElementById(O),r=document.getElementById(C),o=document.getElementById(T),i=document.getElementById(I);if(!(s&&r&&o&&i))return void console.warn("Status elements not found");s.textContent=t.isActive?"YES":"NO",r.textContent=n.isActive?"YES":"NO",s.className=`${l} ${t.isActive?t.restrictedAccess?y:t.membersOnly?u:d:m}`,r.className=`${l} ${n.isActive?n.restrictedAccess?y:n.membersOnly?u:d:m}`,o.textContent=ie(t),i.textContent=ie(n);const a=document.getElementById(_);a&&re.lastUpdated&&(a.textContent=re.lastUpdated.toLocaleTimeString())}function ce(){!function(){const e=document.getElementById(N);if(!e)return void console.warn("Date selector not found");const t=new Date,n=[];for(let e=0;e<8;e++){const s=new Date(t);s.setDate(t.getDate()+e),n.push(s)}e.innerHTML=n.map((e=>{const n=e.toDateString(),s=n===t.toDateString(),r=n===new Date(t.getTime()+864e5).toDateString();let o;return o=s?"Today":r?"Tomorrow":e.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),`<option value="${n}" ${s?"selected":""}>${o}</option>`})).join(""),e.addEventListener("change",(e=>{const t=new Date(e.target.value);re.setSelectedDate(t)}));const s=document.getElementById(B);s&&s.addEventListener("click",(()=>{e.value=t.toDateString(),re.setSelectedDate(t)}));const r=document.getElementById(P);r&&r.addEventListener("click",(()=>{const n=new Date(t.getTime()+864e5);e.value=n.toDateString(),re.setSelectedDate(n)}))}(),re.subscribe((()=>{!function(){const e=re.selectedDate||new Date,t=e.toDateString(),n=document.getElementById(k);if(!n)return void console.warn("Schedule content element not found");const s=new Date,r=re.getEventsForDate(e);if(0===r.length)n.innerHTML='<div class="event">No swimming events scheduled for this day.</div>';else{const o=document.querySelector(x);o&&(t===s.toDateString()?o.textContent="Today's Swimming Schedule":t===new Date(s.getTime()+864e5).toDateString()?o.textContent="Tomorrow's Swimming Schedule":o.textContent=`Swimming Schedule for ${e.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}`),n.innerHTML=r.map((e=>{const n=se(e),r=e.start<=s&&e.end>=s&&t===s.toDateString(),o=e.end<s;let i="";r?i="Busy/Maintenance"===n.type?E:n.restrictedAccess?y:n.membersOnly?u:b:o?i=h:n.membersOnly?i=u:n.restrictedAccess?i=y:"Busy/Maintenance"===n.type&&(i=E);const a=n.lanes&&!e.title.includes("LAP POOL CLOSED"),c=n.restrictedAccess?g:n.membersOnly?S:a?f:w,l=n.restrictedAccess?g:n.membersOnly?S:n.kids?f:w;let d="";return n.membersOnly?d="(Members Only)":n.restrictedAccess&&(d="Women's Only (All Pools)"===n.type?"(Women Only)":"(Seniors 60+ Only)"),`\n          <div class="${p} ${i}" ${r?`id="${M}"`:""}>\n              <div class="event-time">\n                  ${X(e.start)} -\n                  ${X(e.end)}\n                  ${r?'<span style="margin-left: 10px; color: #28a745;">◉ NOW</span>':""}\n              </div>\n              <div class="event-title">${e.title}</div>\n              <div class="event-details">\n                  Lanes: <span class="${c}">${a?"✓":"✗"}</span> |\n                  Kids: <span class="${l}">${n.kids?"✓":"✗"}</span>\n                  ${d?`<br><span style="margin-left: 10px; color: ${n.restrictedAccess?"#9c27b0":"#0056b3"}; font-weight: bold;">${d}</span>`:""}\n              </div>\n          </div>\n        `})).join(""),t===s.toDateString()&&setTimeout((()=>{const e=document.getElementById(M);e&&e.scrollIntoView({behavior:"smooth",block:"center"})}),100)}}(),function(){const e=re.selectedDate,t=new Date,n=new Date(t.getTime()+864e5),s=document.getElementById(B),r=document.getElementById(P);s&&s.classList.toggle(A,e.toDateString()===t.toDateString()),r&&r.classList.toggle(A,e.toDateString()===n.toDateString())}()}))}async function le(){try{!function(e){const t=new Date,n=e.filter(ee).map((e=>{const t=Q(e.start),n=Q(e.end);return t&&n?{id:e.id,title:e.title,start:t,end:n,backgroundColor:e.backgroundColor,textColor:e.textColor,allDay:e.allDay,facility:e.facility||"LCLC > BMO Financial Group Aquatic Centre"}:(console.warn("Skipping event with invalid dates:",e),null)})).filter((e=>null!==e)).sort(((e,t)=>e.start-t.start));re.setEvents(n),re.setSelectedDate(t);const s=Intl.DateTimeFormat().resolvedOptions().timeZone,r=document.getElementById($);r&&(r.textContent=s),document.body.classList.remove("loading")}(await Z())}catch(e){console.error("Error:",e);const t=document.getElementById(k);t&&(t.innerHTML=`<div class="${D}">Unable to load schedule. Please try again later.</div>`),document.body.classList.remove("loading")}}function de(){const e=document.getElementById(O),t=document.getElementById(C);e&&(e.textContent="-"),t&&(t.textContent="-"),document.querySelectorAll(`.${v}`).forEach((e=>{e.addEventListener("click",(()=>{if(document.querySelectorAll(`.${v}`).forEach((e=>e.classList.remove(A))),document.querySelectorAll(`.${L}`).forEach((e=>e.classList.remove(A))),e.classList.add(A),document.getElementById(`${e.dataset.tab}-tab`).classList.add(A),"schedule"===e.dataset.tab){const e=document.getElementById(N);if(e){const t=new Date(e.value),n=new Date;t.toDateString()===n.toDateString()&&setTimeout((()=>{const e=document.getElementById(M);e&&e.scrollIntoView({behavior:"smooth",block:"center"})}),100)}}}))})),document.body.classList.add("loading")}function me(){re.subscribe(ae),ce(),le(),setInterval(le,3e5),setInterval((()=>{re.allEvents.length>0&&ae()}),6e4)}document.addEventListener("DOMContentLoaded",(()=>{de(),setTimeout(me,10)}))}();